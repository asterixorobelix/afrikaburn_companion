# Milestone v3.1: Event Surprise Mode

**Status:** SHIPPED 2026-02-17
**Phases:** 5-8
**Total Plans:** 5

## Overview

Keep Map and Projects tabs hidden until the user is at the AfrikaBurn event (within 20km) or the event has officially started. Preserves the surprise experience for attendees.

## Phases

### Phase 5: Event Date Configuration

**Goal**: Store AfrikaBurn event date/location configuration and detect if current date is past event start.
**Depends on**: Phase 4 (SQLDelight infrastructure)
**Plans**: 1 plan

Plans:
- [x] 05-01: Event Configuration Data Source (with unit tests)

**Details:**
- EventConfig data class with AfrikaBurn 2026 defaults (dates, coordinates, radius)
- EventDateService with isEventStarted(), isEventActive(), isUnlockBypassed()
- Clock injection pattern for testable time-based logic
- Africa/Johannesburg timezone for date calculations
- 12 TDD tests

### Phase 6: Geofence Detection

**Goal**: Detect if user is within 20km radius of AfrikaBurn event location.
**Depends on**: Phase 5, Phase 3 (LocationService)
**Plans**: 1 plan

Plans:
- [x] 06-01: Geofence Distance Calculator (with unit tests)

**Details:**
- DistanceCalculator utility with Haversine formula
- GeofenceService for proximity detection (20km radius)
- 1% tolerance for floating point distance tests
- Boundary inclusive (distance <= radius returns true)
- 25 TDD tests (10 distance, 15 geofence)

### Phase 7: Tab Visibility Control

**Goal**: Conditionally show/hide Map and Projects tabs based on unlock conditions.
**Depends on**: Phase 5, Phase 6
**Plans**: 2 plans

Plans:
- [x] 07-01: Unlock Condition Manager (SQLDelight persistence + TDD tests)
- [x] 07-02: Navigation Tab Filtering (UI integration + welcome message)

**Details:**
- UnlockState SQLDelight schema for permanent unlock persistence
- UnlockConditionManager combining date, geofence, and persistence logic
- getVisibleDestinations() function for filtered navigation
- Welcome snackbar on first unlock (wasJustUnlocked tracking)
- Dynamic start destination (Directions when locked, Projects when unlocked)
- 17 TDD tests for UnlockConditionManager

### Phase 8: Polish & Edge Cases

**Goal**: Handle edge cases, add visual feedback, ensure smooth UX, and verify test coverage.
**Depends on**: Phase 7
**Plans**: 1 plan

Plans:
- [x] 08-01: Edge Cases & Polish

**Details:**
- 3 timezone boundary tests (SAST midnight edge cases)
- 3 permission denial tests (null location scenarios)
- 55 total unlock logic tests confirmed passing
- 187 total project tests passing, detekt clean

---

## Milestone Summary

**Key Decisions:**
- Tabs completely hidden when locked (not visible with lock icon)
- Unlock persists permanently once triggered (no reversion)
- 20km geofence radius for event proximity
- Date OR location unlocks (either condition sufficient)
- Africa/Johannesburg timezone for date calculations
- Clock injection pattern for testable time-based logic
- Epoch milliseconds for timestamp storage
- Directions and About tabs always visible (essential for pre-event use)

**Issues Resolved:**
- Welcome message showing on every launch (fixed with wasJustUnlocked session tracking)
- SAST timezone boundary correctness verified

**Issues Deferred:**
- Jacoco coverage reporting not configured (coverage verified by test count)

**Technical Debt Incurred:**
- Duplicate phase directory (07-tab-visibility and 07-tab-visibility-control)

---

_For current project status, see .planning/ROADMAP.md_
